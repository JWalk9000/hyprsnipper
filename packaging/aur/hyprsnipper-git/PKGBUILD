# Maintainer: JWalk9000 <you@example.com>
pkgname=hyprsnipper-git
pkgver=0.0.0.r0.g0000000
pkgrel=1
pkgdesc="A friendly snipping tool for Hyprland/Wayland (Qt/PySide6) - git version"
arch=('x86_64' 'aarch64')
url="https://github.com/JWalk9000/hyprsnipper"
license=('GPL3')
depends=('python' 'python-pyside6' 'python-yaml' 'grim' 'slurp' 'wl-clipboard' 'libnotify')
optdepends=('swappy: quick annotation editor' 'gimp: image editor' 'krita: image editor')
makedepends=('git')
provides=('hyprsnipper')
conflicts=('hyprsnipper')
source=("${pkgname}::git+${url}.git")
sha256sums=('SKIP')

pkgver() {
  cd "${srcdir}/${pkgname}"
  if git describe --tags --long >/dev/null 2>&1; then
    git describe --tags --long | sed 's/^v//; s/-/./g'
  else
    printf "0.0.0.r%s.g%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
  fi
}

package() {
  cd "${srcdir}/${pkgname}"
  install -d "${pkgdir}/usr/share/hyprsnipper"
  # Install application files
  cp -r src config resources "${pkgdir}/usr/share/hyprsnipper/"
  # Wrapper
  install -d "${pkgdir}/usr/bin"
  printf '#!/bin/sh\ncd /usr/share/hyprsnipper/src\nexec python main.py "$@"\n' > "${pkgdir}/usr/bin/hyprsnipper"
  chmod 755 "${pkgdir}/usr/bin/hyprsnipper"
  # Desktop entry
  install -D -m644 resources/desktop/hyprsnipper.desktop "${pkgdir}/usr/share/applications/hyprsnipper.desktop"
  # Licenses and docs
  install -D -m644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
  install -D -m644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
}
